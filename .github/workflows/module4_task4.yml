---
name: module4_task4
on:
  push:
    branches: [main, master]
  schedule:
    - cron: "0 0 * * *"
  pull_request:
    types: [opened, reopened, edited, ready_for_review]

jobs:
  module4_task2:
    runs-on: ubuntu-18.04
    steps:
      - name: Checkout
        uses: actions/checkout@v3
      - name: docker run
        run: |
          cd module4_task0/
          docker build -t my-app .
          docker run -dp 8080:80 my-app
          ./setup.sh
          make lint
          make clean
          make build
          make unit-tests
          make integration-tests

      #- name: docker-tests

      - name: Release
        uses: softprops/action-gh-release@v1
        with:
          tag_name: 1.0.1
          files: |
            module4_task4/awesome-website.zip
            module4_task4/DEPLOY.md
      - name: archive build
        if: ${{ success()}}
        uses: actions/upload-artifact@v3
        with:
          name: upload-package
          path: module3_task5/awesome-website.zip

      - name: deploy
        uses: akhileshns/heroku-deploy@v3.12.12 # This is the action
        with:
          heroku_api_key: c0584d1d-6f7e-4a3a-92c2-a147718815f5
          heroku_app_name: gentle-stream-93938
          heroku_email: km@rtin.mobi
          usedocker: true
